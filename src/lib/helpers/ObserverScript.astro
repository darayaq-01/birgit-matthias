<script>
    document.addEventListener('DOMContentLoaded', () => {
        // Config observer
        const createObserver = (target, callback, options) => {
            if (target) {
                const observer = new IntersectionObserver(callback, options);
                observer.observe(target);
                return observer;
            }
        };

        // Callback 1st observer - CORREGIDO
        const handleNavbarVisibility = (entries) => {
            const linkElement = document.querySelector(
                '#navbar .linkLogoClass'
            );

            entries.forEach((entry) => {
                if (linkElement) {
                    // Cuando el sentinel ESTÁ visible = estamos en el top
                    // Cuando el sentinel NO está visible = hemos hecho scroll
                    if (entry.isIntersecting) {
                        // Estamos en el top de la página
                        linkElement.classList.add('initial-scroll');
                        linkElement.classList.remove('on-scroll');
                    } else {
                        // Hemos hecho scroll hacia abajo
                        linkElement.classList.remove('initial-scroll');
                        linkElement.classList.add('on-scroll');
                    }
                }
            });
        };

        // Callback 2nd observer
        const handleSentinelVisibility = (entries) => {
            entries.forEach((entry) => {
                const werkeMenuItem = document.querySelector(
                    '[data-link][href="/#werke"]'
                );
                const homeMenuItem = document.querySelector(
                    '[data-link][href="/"]'
                );
                if (entry.isIntersecting) {
                    werkeMenuItem?.classList.add('active-item');
                    homeMenuItem?.classList.remove('active-item');
                } else {
                    werkeMenuItem?.classList.remove('active-item');
                    homeMenuItem?.classList.add('active-item');
                }
            });
        };

        // Config options - AJUSTADO
        const observerOptions1 = {
            root: null,
            rootMargin: '-1px 0px 0px 0px', // Cambiado para mejor detección
            threshold: 0,
        };
        const observerOptions2 = {
            root: null,
            rootMargin: '0px',
            threshold: 0.2,
        };

        // Create and configure observers
        const sentinel = document.getElementById('sentinel');
        const werkeSection = document.getElementById('werke');

        if (sentinel) {
            createObserver(sentinel, handleNavbarVisibility, observerOptions1);
        }

        if (werkeSection) {
            createObserver(
                werkeSection,
                handleSentinelVisibility,
                observerOptions2
            );
        }
    });
</script>
