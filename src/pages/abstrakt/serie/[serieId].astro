---
import IndexGallery from '@components/gallery/IndexGallery.astro';
import { getCollection } from 'astro:content';

export async function getStaticPaths() {
    const entries = await getCollection('collectionImages');

    const seriesIds = [
        ...new Set(
            entries
                .filter((entry) => entry.data?.seriesId)
                .map((entry) => entry.data.seriesId)
        ),
    ];

    return seriesIds.map((serieId) => ({
        params: { serieId },
    }));
}

const { serieId } = Astro.params;
const collection = await getCollection('collectionImages');

const coverImage = collection.find(
    (entry) => entry.data?.seriesId === serieId && entry.data?.isSeriesCover
);

const seriesImages = collection
    .filter((entry) => entry.data?.seriesId === serieId)
    .map((entry) => ({
        id: entry.slug,
        folder: entry.data?.category.toLowerCase(),
        title: entry.data?.title,
        sortOrder: entry.data?.sortOrder,
        description: entry.data?.description,
        imageUrl: entry.data?.imageUrl,
        imageAlt: entry.data?.imageAlt,
        price: entry.data?.price,
        sold: entry.data?.sold,
        year: entry.data?.year,
        isSeries: false,
        seriesId: null,
    }));

const sortOrder = (a: { sortOrder: number }, b: { sortOrder: number }) =>
    a.sortOrder - b.sortOrder || 0;
seriesImages.sort(sortOrder);
console.log(seriesImages[0].folder);
const URL = `${seriesImages[0].folder}`;
console.log(URL);
const serieTitle = coverImage?.data?.title || 'Serie';
---

<IndexGallery
    title={serieTitle}
    header={`Serie: ${serieTitle}`}
    dataArt={seriesImages}
    backUrl={`/${URL}`}
/>
